<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>æ—ä¹‹æ’ äº²å­æ—¥è¯­å­¦ä¹ å¡ç‰‡ 2025-12-18</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;600;700;900&family=M+PLUS+Rounded+1c:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#F5F0E8;--card-bg:#FFFEF9;--text:#2D2A24;--text-sub:#7A7468;
  --accent:#E8573A;--primary:#2B7A98;--secondary:#D4553A;--tertiary:#3A8F5C;
  --vocab:#7B5EA7;--song:#D4903A;--game:#2B8F8F;
  --shadow:0 2px 20px rgba(45,42,36,.08);
  --shadow-lg:0 8px 40px rgba(45,42,36,.12);
  --r:20px;--rs:12px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{scroll-behavior:smooth}
body{font-family:'Noto Sans SC','M PLUS Rounded 1c',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;overflow-x:hidden;min-height:100vh}

.header{position:relative;overflow:hidden;padding:32px 20px 24px;text-align:center;background:linear-gradient(135deg,#2B7A98 0%,#1E5F7A 50%,#2B7A98 100%);color:#fff}
.header::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle at 30% 40%,rgba(255,255,255,.08) 0%,transparent 50%)}
.header h1{font-family:'M PLUS Rounded 1c','Noto Sans SC',sans-serif;font-size:26px;font-weight:900;letter-spacing:1px;text-shadow:0 2px 8px rgba(0,0,0,.2);position:relative}
.header .sub{font-size:13px;opacity:.8;margin-top:4px;position:relative}
.back-link{position:absolute;left:16px;top:16px;color:#fff;text-decoration:none;font-size:24px;opacity:.7;z-index:10}
.back-link:hover{opacity:1}

.tab-nav{display:flex;gap:6px;padding:12px 16px;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;position:sticky;top:0;z-index:100;background:var(--bg)}
.tab-nav::-webkit-scrollbar{display:none}
.tab-btn{flex-shrink:0;padding:8px 16px;border-radius:24px;border:2px solid transparent;font-size:13px;font-weight:700;cursor:pointer;background:#fff;color:var(--text-sub);transition:all .25s cubic-bezier(.4,0,.2,1);box-shadow:0 1px 4px rgba(0,0,0,.04);white-space:nowrap}
.tab-btn.active{color:#fff;border-color:transparent;transform:scale(1.05);box-shadow:var(--shadow)}
.tab-btn[data-sec="0"].active{background:var(--primary)}
.tab-btn[data-sec="1"].active{background:var(--secondary)}
.tab-btn[data-sec="2"].active{background:var(--game)}

.section{display:none;padding:12px 16px 80px;animation:fadeIn .3s ease}
.section.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

.sec-title{font-size:22px;font-weight:900;margin-bottom:16px;display:flex;align-items:center;gap:10px}
.sec-title .icon{font-size:28px}
.sec-title .jp{font-size:14px;font-weight:400;color:var(--text-sub)}

.card-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px;margin-bottom:20px}
.flip-card{perspective:800px;height:180px;cursor:pointer}
.flip-inner{position:relative;width:100%;height:100%;transition:transform .5s cubic-bezier(.4,0,.2,1);transform-style:preserve-3d}
.flip-card.flipped .flip-inner{transform:rotateY(180deg)}
.flip-card.playing .flip-inner{box-shadow:0 0 0 3px var(--accent),var(--shadow-lg);border-radius:var(--r)}
.flip-front,.flip-back{position:absolute;width:100%;height:100%;backface-visibility:hidden;-webkit-backface-visibility:hidden;border-radius:var(--r);padding:12px 10px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--card-bg);box-shadow:var(--shadow);border:2px solid #f0ece4;transition:border-color .2s,box-shadow .2s}
.flip-back{transform:rotateY(180deg);background:#FFF8F0}
.flip-front .emoji{font-size:42px;line-height:1.1;margin-bottom:4px}
.flip-front .kanji{font-family:'M PLUS Rounded 1c',sans-serif;font-size:26px;font-weight:900}
.flip-front .kana{font-size:14px;color:var(--text-sub);margin-top:2px}
.flip-front .speaker{position:absolute;top:8px;right:10px;font-size:16px;opacity:.3;transition:opacity .2s}
.flip-card.playing .speaker{opacity:1}
.flip-back .romaji{font-size:16px;font-weight:700;color:var(--accent);background:#FFF0EC;padding:4px 12px;border-radius:8px;margin-bottom:6px}
.flip-back .chinese{font-size:18px;font-weight:700;color:#C04030}
.flip-back .hint-text{font-size:11px;color:var(--text-sub);margin-top:6px;text-align:center}
.reviewed .flip-front{border-color:#B8E6C8}
.reviewed .flip-front::after{content:'âœ“';position:absolute;bottom:6px;right:8px;font-size:14px;color:#3A8F5C;font-weight:900}

.sent-card{background:var(--card-bg);border-radius:var(--r);padding:16px;margin-bottom:12px;cursor:pointer;box-shadow:var(--shadow);border:2px solid #f0ece4;transition:all .25s;position:relative;overflow:hidden}
.sent-card:active{transform:scale(.98)}
.sent-card.playing{border-color:var(--accent);box-shadow:0 0 0 2px var(--accent),var(--shadow-lg)}
.sent-card .jp-text{font-family:'M PLUS Rounded 1c',sans-serif;font-size:20px;font-weight:700;margin-bottom:4px;display:flex;align-items:center;gap:8px}
.sent-card .kana-text{font-size:14px;color:var(--primary);padding-left:28px}
.sent-card .romaji-text{font-size:12px;color:#bbb;font-style:italic;padding-left:28px}
.sent-card .cn-text{font-size:15px;color:#C04030;font-weight:600;padding-left:28px;margin-top:4px}
.sent-card .wave{position:absolute;bottom:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--accent),var(--secondary));transform:scaleX(0);transform-origin:left;transition:transform .3s}
.sent-card.playing .wave{transform:scaleX(1);transition:transform 2s linear}

.tip-box{background:#FAF7F0;border-left:4px solid var(--text-sub);border-radius:0 var(--rs) var(--rs) 0;padding:12px 16px;margin:12px 0;font-size:13px;color:var(--text-sub);line-height:1.6}
.tip-box b{color:var(--text)}

.quiz-area{padding:8px 0}
.quiz-card{background:var(--card-bg);border-radius:var(--r);padding:24px;text-align:center;box-shadow:var(--shadow);margin-bottom:16px;border:2px solid #f0ece4}
.quiz-emoji{font-size:64px;margin-bottom:12px}
.quiz-prompt{font-size:16px;color:var(--text-sub);margin-bottom:16px}
.quiz-options{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.quiz-opt{padding:14px;border-radius:var(--rs);border:2px solid #e8e4dc;font-size:16px;font-weight:700;cursor:pointer;background:#fff;transition:all .2s;font-family:'M PLUS Rounded 1c',sans-serif}
.quiz-opt:active{transform:scale(.96)}
.quiz-opt.correct{background:#D4EDDA;border-color:#3A8F5C;color:#2D6A3F}
.quiz-opt.wrong{background:#F8D7DA;border-color:#C0392B;color:#8B1A1A}
.quiz-score{text-align:center;padding:20px;font-size:18px;font-weight:700}
.quiz-btn{display:block;margin:16px auto;padding:12px 32px;border-radius:24px;border:none;font-size:15px;font-weight:700;cursor:pointer;color:#fff;background:var(--game);box-shadow:var(--shadow);transition:all .2s}
.quiz-btn:active{transform:scale(.96)}

.practice{background:var(--card-bg);border-radius:var(--r);padding:16px;margin-bottom:12px;box-shadow:var(--shadow)}
.practice b{color:var(--game)}
.practice-title{font-size:16px;font-weight:700;margin-bottom:6px}

.controls{display:flex;align-items:center;gap:8px;padding:8px 16px;margin:0 0 12px;background:#fff;border-radius:var(--rs);box-shadow:var(--shadow)}
.play-all-btn{margin-left:auto;padding:6px 16px;border-radius:20px;border:none;font-size:12px;font-weight:700;cursor:pointer;color:#fff;transition:all .2s}
.play-all-btn:active{transform:scale(.95)}
.play-all-btn.stop{background:#C0392B!important}
.progress-bar{flex:1;height:4px;background:#e8e4dc;border-radius:2px;margin:0 8px;min-width:40px;overflow:hidden}
.progress-fill{height:100%;border-radius:2px;transition:width .4s ease;width:0}

.speed-toggle{display:flex;border-radius:20px;overflow:hidden;border:2px solid #e8e4dc}
.speed-btn{padding:6px 14px;font-size:12px;font-weight:700;cursor:pointer;border:none;background:transparent;color:var(--text-sub);transition:all .2s}
.speed-btn.on{background:var(--text);color:#fff}

.footer{text-align:center;padding:24px 16px;font-size:12px;color:var(--text-sub)}

@keyframes bounce{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
.bounce{animation:bounce .3s ease}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-4px)}75%{transform:translateX(4px)}}
.shake{animation:shake .3s ease}

@media(max-width:400px){
  .card-grid{grid-template-columns:repeat(auto-fill,minmax(120px,1fr))}
  .flip-card{height:160px}
  .flip-front .emoji{font-size:34px}
  .flip-front .kanji{font-size:22px}
}

.flip-front .emoji img{width:42px;height:42px;object-fit:contain}
.quiz-emoji img{width:64px;height:64px;object-fit:contain}
.lesson-icon img{width:36px;height:36px;object-fit:contain}
.song-card .note img{width:48px;height:48px;object-fit:contain}

.tab-btn img{width:18px;height:18px;object-fit:contain;vertical-align:middle;margin-right:2px}
h1 img{width:28px;height:28px;object-fit:contain;vertical-align:middle}
.tip-box img{width:20px;height:20px;object-fit:contain;vertical-align:middle}
@media(max-width:400px){.flip-front .emoji img{width:34px;height:34px}}
</style>
</head>
<body>

<div class="header">
  <a class="back-link" href="../index.html">â†</a>
  <h1>ğŸŒ æ—ä¹‹æ’ æ—¥è¯­å­¦ä¹ å¡ç‰‡</h1>
  <div class="sub">2025å¹´12æœˆ18æ—¥ Â· èš‚èšä¹˜å…¬äº¤è½¦å‡ºé—¨------ç»˜æœ¬ Â· ç‚¹å‡»ç¿»è½¬+å‘éŸ³</div>
</div>

<nav class="tab-nav" id="tabNav">
  <button class="tab-btn active" data-sec="0" onclick="switchTab(0)">ğŸ“š è¯æ±‡</button><button class="tab-btn" data-sec="1" onclick="switchTab(1)">ğŸ—£ï¸ å¥å­</button>
</nav>

<div class="section active" id="sec0">
<div class="controls">
  <div class="speed-toggle"><button class="speed-btn on" onclick="setRate(1)">å¸¸é€Ÿ</button><button class="speed-btn" onclick="setRate(0.6)">æ…¢é€Ÿ</button></div>
  <div class="progress-bar"><div class="progress-fill" id="prog0" style="background:var(--primary)"></div></div>
  <button class="play-all-btn" style="background:var(--primary)" onclick="playAllTTS(this)">â–¶ å…¨éƒ¨</button>
</div>
<div class="sec-title" style="color:var(--primary)"><span class="icon">ğŸ“š</span>è¯æ±‡å­¦ä¹ </div>
<div class="card-grid" id="grid0">
<div class="flip-card" data-k="bÅ«bÅ«" onclick="tapCard(this)"><div class="flip-inner"><div class="flip-front"><div class="speaker">ğŸ”ˆ</div><div class="emoji">ğŸ“</div><div class="kanji">ãƒ–ãƒ¼ãƒ–ãƒ¼</div><div class="kana">ã¶ãƒ¼ã¶ãƒ¼</div></div><div class="flip-back"><div class="romaji">bÅ«-bÅ«</div><div class="chinese">å˜Ÿå˜Ÿ</div></div></div></div>
<div class="flip-card" data-k="yamagamietekimashita" onclick="tapCard(this)"><div class="flip-inner"><div class="flip-front"><div class="speaker">ğŸ”ˆ</div><div class="emoji">ğŸ“</div><div class="kanji">å±±ãŒè¦‹ãˆã¦ãã¾ã—ãŸã€‚</div><div class="kana">ã‚„ã¾ãŒ
ã¿ãˆã¦ãã¾ã—ãŸ</div></div><div class="flip-back"><div class="romaji">yama ga miete kimashita</div><div class="chinese">å±±æ¸æ¸çœ‹è§äº†/å±±è¶Šæ¥è¶Šè¿‘ã€è¶Šæ¥è¶Šæ¸…æ¥šäº†</div></div></div></div>
<div class="flip-card" data-k="rakudadesu" onclick="tapCard(this)"><div class="flip-inner"><div class="flip-front"><div class="speaker">ğŸ”ˆ</div><div class="emoji">ğŸ«</div><div class="kanji">ãƒ©ã‚¯ãƒ€ã§ã™ã€‚</div><div class="kana">ã‚‰ãã ã§ã™</div></div><div class="flip-back"><div class="romaji">rakuda desu</div><div class="chinese">æ˜¯éª†é©¼</div></div></div></div>
</div>
</div>

<div class="section" id="sec1">
<div class="sec-title" style="color:var(--secondary)"><span class="icon">ğŸ—£ï¸</span>å¥å­ç»ƒä¹ </div>
<div class="sent-card" data-k="sent0" onclick="playSentTTS(this, 'ã‚¬ã‚¿ã‚¬ã‚¿ã€€ã‚´ãƒˆã‚´ãƒˆ')">
  <div class="jp-text">ğŸ”ˆ ã‚¬ã‚¿ã‚¬ã‚¿ã€€ã‚´ãƒˆã‚´ãƒˆ</div>
  <div class="kana-text">ãŒãŸãŒãŸã€€ã”ã¨ã”ã¨</div>
  <div class="romaji-text">gata-gata goto-goto</div>
  <div class="cn-text">å’¯å™”å’¯å™”ã€å’•å’šå’•å’šï¼ˆå…¬äº¤è½¦é¢ ç°¸è¡Œé©¶çš„å£°éŸ³</div>
  <div class="wave"></div>
</div>
<div class="sent-card" data-k="sent1" onclick="playSentTTS(this, 'å±±ãŒè¦‹ãˆã¦ãã¾ã—ãŸã€‚')">
  <div class="jp-text">ğŸ”ˆ å±±ãŒè¦‹ãˆã¦ãã¾ã—ãŸã€‚</div>
  <div class="kana-text">ã‚„ã¾ãŒ
ã¿ãˆã¦ãã¾ã—ãŸ</div>
  <div class="romaji-text">yama ga miete kimashita</div>
  <div class="cn-text">å±±æ¸æ¸çœ‹è§äº†/å±±è¶Šæ¥è¶Šè¿‘ã€è¶Šæ¥è¶Šæ¸…æ¥šäº†</div>
  <div class="wave"></div>
</div>
<div class="sent-card" data-k="sent2" onclick="playSentTTS(this, 'ãƒ©ã‚¯ãƒ€ãŒ å”è¾›å­ã‚’ é£Ÿã¹ã¾ã—ãŸã€‚')">
  <div class="jp-text">ğŸ”ˆ ãƒ©ã‚¯ãƒ€ãŒ å”è¾›å­ã‚’ é£Ÿã¹ã¾ã—ãŸã€‚</div>
  <div class="kana-text">ã‚‰ãã ãŒ ã¨ã†ãŒã‚‰ã—ã‚’
ãŸã¹ã¾ã—ãŸ</div>
  <div class="romaji-text">rakuda ga tÅgarashi o tabemashita</div>
  <div class="cn-text">éª†é©¼åƒäº†è¾£æ¤’</div>
  <div class="wave"></div>
</div>
<div class="sent-card" data-k="sent3" onclick="playSentTTS(this, 'ã“ã‚ã“ã‚ ã‚Šã‚“ã”')">
  <div class="jp-text">ğŸ”ˆ ã“ã‚ã“ã‚ ã‚Šã‚“ã”</div>
  <div class="kana-text">ã“ã‚ã“ã‚ ã‚Šã‚“ã”</div>
  <div class="romaji-text">koro-koro ringo</div>
  <div class="cn-text">å’•å™œå’•å™œçš„è‹¹æœ/æ»šæ¥æ»šå»çš„è‹¹æœ</div>
  <div class="wave"></div>
</div>
<div class="sent-card" data-k="sent4" onclick="playSentTTS(this, 'ã‚ã‚Šã® ãŠã§ã‹ã‘')">
  <div class="jp-text">ğŸ”ˆ ã‚ã‚Šã® ãŠã§ã‹ã‘</div>
  <div class="kana-text">ã‚ã‚Šã® ãŠã§ã‹ã‘</div>
  <div class="romaji-text">ari no odekake</div>
  <div class="cn-text">èš‚èšå‡ºé—¨</div>
  <div class="wave"></div>
</div>
<div class="sent-card" data-k="sent5" onclick="playSentTTS(this, 'ã‚ã‚Šã¡ã‚ƒã‚“ã¯ ãƒã‚¹ã§ ãŠã§ã‹ã‘ã§ã™')">
  <div class="jp-text">ğŸ”ˆ ã‚ã‚Šã¡ã‚ƒã‚“ã¯ ãƒã‚¹ã§ ãŠã§ã‹ã‘ã§ã™</div>
  <div class="kana-text">ã‚ã‚Šã¡ã‚ƒã‚“ã¯
ã°ã™ã§ ãŠã§ã‹ã‘ã§ã™</div>
  <div class="romaji-text">ari chan wa basu de odekake desu</div>
  <div class="cn-text">èš‚èšä¹˜åå…¬äº¤è½¦å‡ºé—¨</div>
  <div class="wave"></div>
</div>

</div>

<div class="footer">ğŸ“± ç‚¹å‡»å¡ç‰‡ç¿»è½¬å­¦ä¹  Â· ç‚¹å‡»å‘éŸ³æŒ‰é’®å¬æ—¥è¯­ Â· <a href="../index.html" style="color:var(--primary)">è¿”å›è¯¾ç¨‹åˆ—è¡¨</a></div>

<script>
var activeTab=0,speechRate=1,curEl=null,running=false;
var reviewed={};
var vocabKeys=["b\u016bb\u016b", "yamagamietekimashita", "rakudadesu"];
var quizVocab=[{"k": "bÅ«bÅ«", "e": "ğŸ“", "jp": "ãƒ–ãƒ¼ãƒ–ãƒ¼", "cn": "å˜Ÿå˜Ÿ"}, {"k": "yamagamietekimashita", "e": "ğŸ“", "jp": "å±±ãŒè¦‹ãˆã¦ãã¾ã—ãŸã€‚", "cn": "å±±æ¸æ¸çœ‹è§äº†/å±±è¶Šæ¥è¶Šè¿‘ã€è¶Šæ¥è¶Šæ¸…æ¥šäº†"}, {"k": "rakudadesu", "e": "ğŸ«", "jp": "ãƒ©ã‚¯ãƒ€ã§ã™ã€‚", "cn": "æ˜¯éª†é©¼"}];
var quizTotal=Math.min(5,quizVocab.length);
var quizQ=0,quizScore=0,quizList=[];

function switchTab(i){
  if(running)stopAll();activeTab=i;
  document.querySelectorAll('.section').forEach(function(s,idx){s.classList.toggle('active',idx===i)});
  document.querySelectorAll('.tab-btn').forEach(function(b,idx){b.classList.toggle('active',idx===i)});
  document.querySelectorAll('.tab-btn')[i].scrollIntoView({behavior:'smooth',inline:'center',block:'nearest'});
}

function setRate(r){
  speechRate=r;
  document.querySelectorAll('.speed-btn').forEach(function(b){
    b.classList.toggle('on',r===1?(b.textContent==='å¸¸é€Ÿ'):(b.textContent==='æ…¢é€Ÿ'));
  });
}

var currentAudio=null;
var audioMap={"å±±ãŒè¦‹ãˆã¦ãã¾ã—ãŸã€‚":"../audio/e08e9a97c0db.mp3","ã‚¬ã‚¿ã‚¬ã‚¿ã€€ã‚´ãƒˆã‚´ãƒˆ":"../audio/17b9b8e3d54f.mp3","ãƒ©ã‚¯ãƒ€ãŒ å”è¾›å­ã‚’ é£Ÿã¹ã¾ã—ãŸã€‚":"../audio/b54584535680.mp3","ã‚ã‚Šã® ãŠã§ã‹ã‘":"../audio/3e0ef6c4207b.mp3","ã‚‰ãã ã§ã™":"../audio/7cbbeeef10da.mp3","ã¶ãƒ¼ã¶ãƒ¼":"../audio/5c534c7a2b4f.mp3","ã“ã‚ã“ã‚ ã‚Šã‚“ã”":"../audio/497823d728f4.mp3","ã‚ã‚Šã¡ã‚ƒã‚“ã¯ ãƒã‚¹ã§ ãŠã§ã‹ã‘ã§ã™":"../audio/ba9f1d63377a.mp3"};
var bestJPVoice=null;
function findBestJPVoice(){
  var voices=window.speechSynthesis.getVoices();
  var jp=voices.filter(function(v){return v.lang&&v.lang.indexOf('ja')===0});
  if(!jp.length)return null;
  var enhanced=jp.filter(function(v){return /Enhanced|Premium/i.test(v.name)});
  if(enhanced.length)return enhanced[0];
  var preferred=['Kyoko','O-Ren','Hattori','Otoya'];
  for(var p=0;p<preferred.length;p++){for(var i=0;i<jp.length;i++){if(jp[i].name.indexOf(preferred[p])>=0)return jp[i]}}
  return jp[0];
}
function speakJPLocal(text,cb){
  if('speechSynthesis' in window){
    window.speechSynthesis.cancel();
    var u=new SpeechSynthesisUtterance(text);
    u.lang='ja-JP';u.rate=speechRate;u.pitch=1.1;
    if(!bestJPVoice)bestJPVoice=findBestJPVoice();
    if(bestJPVoice)u.voice=bestJPVoice;
    u.onend=function(){if(cb)cb()};
    u.onerror=function(){if(cb)cb()};
    window.speechSynthesis.speak(u);
  } else if(cb) cb();
}
function speakJPOnline(text,cb){
  try{
    var a=new Audio('https://translate.googleapis.com/translate_tts?client=gtx&ie=UTF-8&tl=ja&q='+encodeURIComponent(text));
    currentAudio=a;
    if(speechRate!==1)a.playbackRate=speechRate;
    a.onended=function(){currentAudio=null;if(cb)cb()};
    a.onerror=function(){currentAudio=null;speakJPLocal(text,cb)};
    a.play().catch(function(){currentAudio=null;speakJPLocal(text,cb)});
  }catch(e){speakJPLocal(text,cb)}
}
function speakJP(text,cb){
  if(currentAudio){currentAudio.pause();currentAudio=null}
  window.speechSynthesis&&window.speechSynthesis.cancel();
  text=text.replace(/[\u{1F4E3}\u{1F508}\u{1F509}\u{1F50A}\u{1F3B6}\u{1F3B5}]/gu,'').trim();
  var path=audioMap[text];
  if(path){
    try{
      var a=new Audio(path);
      currentAudio=a;
      if(speechRate!==1)a.playbackRate=speechRate;
      a.onended=function(){currentAudio=null;if(cb)cb()};
      a.onerror=function(){currentAudio=null;speakJPOnline(text,cb)};
      a.play().catch(function(){currentAudio=null;speakJPOnline(text,cb)});
      return;
    }catch(e){}
  }
  speakJPOnline(text,cb);
}


function tapCard(el){
  var k=el.getAttribute('data-k');
  el.classList.toggle('flipped');
  if(curEl)curEl.classList.remove('playing');
  el.classList.add('playing');curEl=el;
  // Get kana text for TTS
  var kana=el.querySelector('.kana');
  if(kana) speakJP(kana.textContent, function(){el.classList.remove('playing');el.classList.add('reviewed');reviewed[k]=true;updateProgress()});
}

function playSentTTS(el,jp){
  document.querySelectorAll('.sent-card').forEach(function(s){s.classList.remove('playing')});
  el.classList.add('playing');
  speakJP(jp,function(){el.classList.remove('playing')});
}

function playAllTTS(btn){
  if(running){stopAll();btn.textContent='â–¶ å…¨éƒ¨';btn.classList.remove('stop');return}
  running=true;btn.textContent='â¹ åœæ­¢';btn.classList.add('stop');
  var cards=document.querySelectorAll('#grid0 .flip-card');
  var i=0;
  function next(){
    if(i>=cards.length||!running){running=false;btn.textContent='â–¶ å…¨éƒ¨';btn.classList.remove('stop');return}
    var el=cards[i];
    el.classList.add('playing');if(curEl&&curEl!==el)curEl.classList.remove('playing');curEl=el;
    var kana=el.querySelector('.kana');
    if(kana)speakJP(kana.textContent,function(){el.classList.remove('playing');el.classList.add('reviewed');reviewed[el.getAttribute('data-k')]=true;updateProgress();i++;next()});
    else{i++;next()}
  }
  next();
}

function stopAll(){running=false;if(currentAudio){currentAudio.pause();currentAudio=null}window.speechSynthesis&&window.speechSynthesis.cancel();if(curEl){curEl.classList.remove('playing');curEl=null}}

function updateProgress(){
  var done=vocabKeys.filter(function(k){return reviewed[k]}).length;
  var pct=vocabKeys.length?Math.round(done/vocabKeys.length*100):0;
  var bar=document.getElementById('prog0');if(bar)bar.style.width=pct+'%';
}

function shuffle(a){for(var i=a.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var t=a[i];a[i]=a[j];a[j]=t}return a}
function startQuiz(){quizQ=0;quizScore=0;quizList=shuffle(quizVocab.slice()).slice(0,quizTotal);showQuestion()}
function showQuestion(){
  var area=document.getElementById('quizArea');
  if(quizQ>=quizList.length){
    area.innerHTML='<div class="quiz-card"><div class="quiz-emoji">ğŸ‰</div><div class="quiz-score">å¾—åˆ†ï¼š'+quizScore+' / '+quizTotal+'</div><div style="font-size:14px;color:var(--text-sub)">'+(quizScore>=Math.ceil(quizTotal*0.8)?'å¤ªæ£’äº†Alexï¼ğŸŒŸ':'ç»§ç»­åŠ æ²¹ï¼ğŸ’ª')+'</div></div><button class="quiz-btn" onclick="startQuiz()">å†æ¥ä¸€æ¬¡ï¼</button>';
    return;
  }
  var q=quizList[quizQ],opts=[q],pool=quizVocab.filter(function(v){return v.k!==q.k});
  shuffle(pool);for(var i=0;i<3&&i<pool.length;i++)opts.push(pool[i]);shuffle(opts);
  var h='<div class="quiz-card"><div style="font-size:12px;color:var(--text-sub);margin-bottom:8px">ç¬¬ '+(quizQ+1)+' / '+quizTotal+' é¢˜</div>';
  h+='<div class="quiz-emoji">'+q.e+'</div><div class="quiz-prompt">è¿™ä¸ªç”¨æ—¥è¯­æ€ä¹ˆè¯´ï¼Ÿ</div><div class="quiz-options">';
  opts.forEach(function(o){h+='<button class="quiz-opt" data-correct="'+(o.k===q.k?'1':'0')+'" data-k="'+o.k+'" onclick="answer(this,\''+q.k+'\')">'+o.jp+'</button>'});
  h+='</div></div>';area.innerHTML=h;
  // Speak the word
  speakJP(q.jp);
}
function answer(btn,ck){
  var ok=btn.getAttribute('data-correct')==='1';
  btn.parentElement.querySelectorAll('.quiz-opt').forEach(function(b){b.onclick=null;if(b.getAttribute('data-k')===ck)b.classList.add('correct');else if(b===btn&&!ok)b.classList.add('wrong')});
  if(ok){quizScore++;btn.classList.add('bounce')}else{btn.classList.add('shake')}
  setTimeout(function(){quizQ++;showQuestion()},1200);
}

// Init: preload voices as fallback
if('speechSynthesis' in window){
  window.speechSynthesis.getVoices();
  window.speechSynthesis.onvoiceschanged=function(){bestJPVoice=findBestJPVoice()};
}
if(quizVocab.length>=4)startQuiz();
</script>


<script>
var emojiImgMap={"â˜‚ï¸":"../img/umbrella.png?v2","â˜•":"../img/coffee.png?v2","âœ…":"../img/check_mark.png?v2","âœˆï¸":"../img/airplane.png?v2","âœï¸":"../img/pencil.png?v2","âœ¨":"../img/sparkles.png?v2","â„ï¸":"../img/snowflake.png?v2","âŒ":"../img/cross_mark.png?v2","â“":"../img/question.png?v2","â—":"../img/exclamation.png?v2","â­":"../img/star.png?v2","â­•":"../img/circle.png?v2","ğŸŒˆ":"../img/rainbow.png?v2","ğŸŒŠ":"../img/wave.png?v2","ğŸŒŸ":"../img/glowing_star.png?v2","ğŸŒ¸":"../img/sakura.png?v2","ğŸ‡":"../img/grapes.png?v2","ğŸ‰":"../img/watermelon.png?v2","ğŸŠ":"../img/orange.png?v2","ğŸŒ":"../img/banana.png?v2","ğŸ":"../img/apple.png?v2","ğŸš":"../img/rice.png?v2","ğŸœ":"../img/ramen.png?v2","ğŸ£":"../img/sushi.png?v2","ğŸ°":"../img/cake.png?v2","ğŸ±":"../img/bento.png?v2","ğŸˆ":"../img/balloon.png?v2","ğŸ‰":"../img/party_popper.png?v2","ğŸŒ":"../img/crossed_flags.png?v2","ğŸ“":"../img/graduation_cap.png?v2","ğŸ®":"../img/game.png?v2","ğŸ¯":"../img/target.png?v2","ğŸµ":"../img/music.png?v2","ğŸ¶":"../img/notes.png?v2","ğŸ¸":"../img/guitar.png?v2","ğŸ¹":"../img/piano.png?v2","ğŸº":"../img/trumpet.png?v2","ğŸ†":"../img/trophy.png?v2","ğŸ ":"../img/house.png?v2","ğŸ¥":"../img/hospital.png?v2","ğŸª":"../img/store.png?v2","ğŸ«":"../img/school.png?v2","ğŸ":"../img/mouse.png?v2","ğŸ‚":"../img/ox.png?v2","ğŸƒ":"../img/buffalo.png?v2","ğŸ„":"../img/cow.png?v2","ğŸ‡":"../img/rabbit2.png?v2","ğŸˆ":"../img/cat2.png?v2","ğŸŠ":"../img/crocodile.png?v2","ğŸ‹":"../img/whale.png?v2","ğŸ":"../img/snake.png?v2","ğŸ":"../img/racehorse.png?v2","ğŸ":"../img/ram.png?v2","ğŸ‘":"../img/sheep.png?v2","ğŸ’":"../img/monkey.png?v2","ğŸ“":"../img/rooster.png?v2","ğŸ•":"../img/dog2.png?v2","ğŸ–":"../img/pig2.png?v2","ğŸ˜":"../img/elephant.png?v2","ğŸ›":"../img/bug.png?v2","ğŸœ":"../img/ant.png?v2","ğŸ":"../img/bee.png?v2","ğŸ":"../img/ladybug.png?v2","ğŸŸ":"../img/fish.png?v2","ğŸ ":"../img/tropical_fish.png?v2","ğŸ¡":"../img/blowfish.png?v2","ğŸ¢":"../img/turtle.png?v2","ğŸ¥":"../img/chick.png?v2","ğŸ¦":"../img/bird.png?v2","ğŸ§":"../img/penguin.png?v2","ğŸ©":"../img/poodle.png?v2","ğŸ«":"../img/camel.png?v2","ğŸ¬":"../img/dolphin.png?v2","ğŸ°":"../img/rabbit.png?v2","ğŸ±":"../img/cat.png?v2","ğŸ²":"../img/dragon_face.png?v2","ğŸ³":"../img/whale2.png?v2","ğŸ´":"../img/horse.png?v2","ğŸµ":"../img/monkey_face.png?v2","ğŸ¶":"../img/dog.png?v2","ğŸ·":"../img/pig.png?v2","ğŸ¸":"../img/frog.png?v2","ğŸº":"../img/wolf.png?v2","ğŸ»":"../img/bear.png?v2","ğŸ¼":"../img/panda.png?v2","ğŸ¾":"../img/paw.png?v2","ğŸ¿ï¸":"../img/squirrel.png?v2","ğŸ‘‚":"../img/ear.png?v2","ğŸ‘…":"../img/tongue.png?v2","ğŸ‘†":"../img/index_pointing_up.png?v2","ğŸ‘":"../img/thumbsup.png?v2","ğŸ‘":"../img/clapping.png?v2","ğŸ’¡":"../img/light_bulb.png?v2","ğŸ’ª":"../img/flexed_biceps.png?v2","ğŸ’»":"../img/laptop.png?v2","ğŸ“–":"../img/book.png?v2","ğŸ“š":"../img/books.png?v2","ğŸ“":"../img/memo.png?v2","ğŸ“±":"../img/mobile_phone.png?v2","ğŸ”":"../img/repeat.png?v2","ğŸ”ˆ":"../img/speaker_low.png?v2","ğŸ”Š":"../img/speaker_high.png?v2","ğŸ””":"../img/bell.png?v2","ğŸ”¤":"../img/abc.png?v2","ğŸ”¥":"../img/fire.png?v2","ğŸ–Šï¸":"../img/pen.png?v2","ğŸ—‚ï¸":"../img/card_index.png?v2","ğŸ—£ï¸":"../img/speaking.png?v2","ğŸ˜Š":"../img/smiling.png?v2","ğŸ˜‹":"../img/yum.png?v2","ğŸ™Œ":"../img/raising_hands.png?v2","ğŸš":"../img/helicopter.png?v2","ğŸš„":"../img/shinkansen.png?v2","ğŸšŒ":"../img/bus.png?v2","ğŸš”":"../img/police_car.png?v2","ğŸš•":"../img/taxi.png?v2","ğŸš—":"../img/car.png?v2","ğŸšœ":"../img/tractor.png?v2","ğŸš¢":"../img/ship.png?v2","ğŸš²":"../img/bicycle.png?v2","ğŸ¤”":"../img/thinking.png?v2","ğŸ¤—":"../img/hugging.png?v2","ğŸ¥›":"../img/milk.png?v2","ğŸ¦€":"../img/crab.png?v2","ğŸ¦":"../img/lion.png?v2","ğŸ¦ƒ":"../img/turkey.png?v2","ğŸ¦…":"../img/eagle.png?v2","ğŸ¦†":"../img/duck.png?v2","ğŸ¦ˆ":"../img/shark.png?v2","ğŸ¦‰":"../img/owl.png?v2","ğŸ¦Š":"../img/fox.png?v2","ğŸ¦‹":"../img/butterfly.png?v2","ğŸ¦Œ":"../img/deer.png?v2","ğŸ¦":"../img/lizard.png?v2","ğŸ¦":"../img/rhino.png?v2","ğŸ¦":"../img/shrimp.png?v2","ğŸ¦‘":"../img/squid.png?v2","ğŸ¦’":"../img/giraffe.png?v2","ğŸ¦“":"../img/zebra.png?v2","ğŸ¦”":"../img/hedgehog.png?v2","ğŸ¦˜":"../img/kangaroo.png?v2","ğŸ¦›":"../img/hippo.png?v2","ğŸ¦œ":"../img/parrot.png?v2","ğŸ¦¢":"../img/swan.png?v2","ğŸ¦¥":"../img/sloth.png?v2","ğŸ¦¦":"../img/otter.png?v2","ğŸ¦§":"../img/orangutan.png?v2","ğŸ¦©":"../img/flamingo.png?v2","ğŸ¦­":"../img/seal.png?v2","ğŸ§ ":"../img/brain.png?v2","ğŸª‘":"../img/chair.png?v2","ğŸª¼":"../img/jellyfish.png?v2"};
function replaceEmojiWithImg(){
  // Direct replacement for elements that contain just an emoji
  document.querySelectorAll('.emoji,.quiz-emoji,.lesson-icon,.note').forEach(function(el){
    var t=el.textContent.trim();
    if(emojiImgMap[t]){
      el.innerHTML='<img src="'+emojiImgMap[t]+'" alt="'+t+'" style="width:1em;height:1em;display:inline-block;vertical-align:middle">';
    }
  });
  // For mixed text+emoji elements, walk text nodes
  document.querySelectorAll('.tab-btn,.tip-box,.practice-title,h1,.footer,.song-title').forEach(function(el){
    if(el.querySelector('img'))return;
    var html=el.innerHTML;
    var changed=false;
    for(var e in emojiImgMap){
      if(html.indexOf(e)!==-1){
        html=html.split(e).join('<img src="'+emojiImgMap[e]+'" alt="'+e+'" style="width:1.2em;height:1.2em;display:inline-block;vertical-align:middle;margin:0 1px">');
        changed=true;
      }
    }
    if(changed)el.innerHTML=html;
  });
}
replaceEmojiWithImg();
var _origShowQ=typeof showQuestion==='function'?showQuestion:null;
if(_origShowQ){
  showQuestion=function(){_origShowQ.apply(this,arguments);setTimeout(replaceEmojiWithImg,50)};
}
</script>
</body>
</html>